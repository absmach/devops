# Copyright (c) Magistrala
# SPDX-License-Identifier: Apache-2.0

defaults:
  logLevel: "info"
  image:
    pullPolicy: "IfNotPresent"
    rootRepository: "magistrala"
    repository: "magistrala"
    tag: "latest"
    # imagePullSecrets:
    #   - {}
  # Replicas of MQTT adapter, NATS, Things, Envoy and Auth
  replicaCount: 3
  natsPort: 4222
  jaegerCollectorPort: 4318
  jaegerTraceRatio: 10
  sendTelemetry: true
  eventStreamURL: "magistrala-nats:4222"

ingress:
  enabled: true
  annotations: {}
  labels: {}
  # Uncomment this block for TLS support in public ingress
  # hostname: ""
  # tls:
  #   hostname: ""
  #   secret: "magistrala-server"

nginxInternal:
  image:
    pullPolicy: "IfNotPresent"
    repository: "nginx"
    tag: "1.19.1-alpine"
  mtls:
    # By default mTLS is disabled. If you use mTLS, comment this block.
    tls: ""
    intermediateCrt: ""
    # Uncomment this block for TLS and mTLS support.
    # Use sh script from /secrets/secrets.sh to create config maps with your certs
    # tls: "magistrala-server"
    # intermediateCrt: "ca"


envoy:
  image:
    pullPolicy: "IfNotPresent"
    repository: "envoyproxy/envoy"
    tag: "v1.31-latest"

jaeger:
  fullnameOverride: magistrala-jaeger
  provisionDataStore:
    cassandra: true
  agent:
    enabled: false
  allInOne:
    enabled: false
  storage:
    type: memory
  collector:
    service:
      otlp:
        grpc:
          name: otlp-grpc
          port: 4317
        http:
          name: otlp-http
          port: 4318
nats:
  config:
    cluster:
      enabled: false
      replicas: 3
    jetstream:
      enabled: true
      fileStore:
        enabled: true
        pvc:
          enabled: true
      memoryStore:
        enabled: true
        maxSize: 2Gi

adapter_coap:
  image: {}
  port: 5683

adapter_http:
  image: {}
  httpPort: 8008

mqtt:
  enabled: true
  securityContext:
    runAsUser: 10000
    runAsGroup: 10000
    fsGroup: 10000
  adapter:
    image:
      repository: "magistrala/mqtt"
    mqttPort: 1884
    wsPort: 8081
    logLevel: "debug"
  broker:
    image:
      repository: "magistrala/vernemq"
    mqttPort: 1883
    wsPort: 8080
    logLevel: "info"
    persistentVolume:
      size: 5Gi
  redisESPort: 6379
  redisCachePort: 6379

spicedb:
  # replicaCount: 1
  image:
    pullSecrets: {}
    repository: authzed/spicedb
    tag: latest
  grpc:
    presharedKey: "helloworld"
    port: 50051
  datastore:
    ## engine can be any one of the two options: postgres (default) , memory
    engine: postgres
  dispatch:
    port: 50053
    enabled: false
  http:
    enabled: false
    port: 8443
  metrics:
    enabled: true
    port: 9090
  nodeSelector: {}
  affinity: {}
  tolerations: {}

postgresqlspicedb:
  ## If you want to use an external database, set this to false and change host & port
  enabled: true
  name: postgresql-spicedb
  host: postgresql-spicedb
  port: &postgresqlSpicedbPort 5432
  database: &postgresqlSpicedbDatabase spicedb
  username: &postgresqlSpicedbUsername magistrala
  password: &postgresqlSpicedbPassword magistrala
  global:
    postgresql:
      auth:
        postgresPassword: *postgresqlSpicedbPassword
        username: *postgresqlSpicedbUsername
        password: *postgresqlSpicedbPassword
        database: *postgresqlSpicedbDatabase
      service:
        ports:
          postgresql: *postgresqlSpicedbPort

auth:
  # logLevel: error
  image: {}
  httpPort: 8189
  grpcPort: 8181
  secret: "supersecret"
  adminEmail: "admin@example.com"
  adminPassword: "12345678"
  accessTokenDuration: "1h"
  refreshTokenDuration: "24h"
  invitationDuration: "168h"
  nodeSelector: {}
  affinity: {}
  tolerations: {}

postgresqlauth:
  ## If you want to use an external database, set this to false and change postgresqlHost & postgresqlPort
  enabled: true
  name: postgresql-auth
  host: postgresql-auth
  port: &postgresqlAuthPort 5432
  database: &postgresqlAuthDatabase auth
  username: &postgresqlAuthUsername magistrala
  password: &postgresqlAuthPassword magistrala
  global:
    postgresql:
      auth:
        postgresPassword: *postgresqlAuthPassword
        username: *postgresqlAuthUsername
        password: *postgresqlAuthPassword
        database: *postgresqlAuthDatabase
      service:
        ports:
          postgresql: *postgresqlAuthPort

users:
  image: {}
  httpPort: 9002
  grpcPort: 7001
  adminEmail: "admin@example.com"
  adminPassword: "12345678"
  secretKey: "secretKey"
  passwordRegex: "^.{8,}$"
  tokenResetEndpoint: "/reset-request"
  allowSelfRegister: true
  deleteInterval: "24h"
  deleteAfter: "720h"

postgresqlusers:
  ## If you want to use an external database, set this to false and change host & port
  enabled: true
  name: postgresql-users
  host: postgresql-users
  port: &postgresqlUsersPort 5432
  database: &postgresqlUsersDatabase users
  username: &postgresqlUsersUsername magistrala
  password: &postgresqlUsersPassword magistrala
  global:
    postgresql:
      auth:
        postgresPassword: *postgresqlUsersPassword
        username: *postgresqlUsersUsername
        password: *postgresqlUsersPassword
        database: *postgresqlUsersDatabase
      service:
        ports:
          postgresql: *postgresqlUsersPort

things:
  image: {}
  httpPort: 9000
  authGrpcPort: 7000
  authHttpPort: 9001
  redisESPort: 6379
  redisCachePort: 6379

postgresqlthings:
  ## If you want to use an external database, set this to false and change postgresqlHost & postgresqlPort
  enabled: true
  name: postgresql-things
  host: postgresql-things
  port: &postgresqlThingsPort 5432
  database: &postgresqlThingsDatabase things
  username: &postgresqlThingsUsername magistrala
  password: &postgresqlThingsPassword magistrala
  global:
    postgresql:
      auth:
        postgresPassword: *postgresqlThingsPassword
        username: *postgresqlThingsUsername
        password: *postgresqlThingsPassword
        database: *postgresqlThingsDatabase
      service:
        ports:
          postgresql: *postgresqlThingsPort

redis-things:
  volumePermissions:
    enabled: true
  cluster:
    enabled: false
  usePassword: false

bootstrap:
  enabled: false
  image: {}
  httpPort: 9013
  redisESPort: 6379

postgresqlbootstrap:
  ## If you want to use an external database, set this to false and change postgresqlHost & postgresqlPort
  enabled: false
  name: postgresql-bootstrap
  postgresqlHost: postgresql-bootstrap
  postgresqlPort: "5432"
  auth:
    postgresPassword: postgres
    username: magistrala
    password: magistrala
    database: bootstrap


certs:
  enabled: false
  image: {}
  httpPort: 9019
  logLevel: "info"
  sdkThingsPrefix: ""
  encryptKey: ""
  clientTLS: ""
  serverCert: ""
  serverKey: ""
  signCAPath: "/etc/ssl/certs/ca.crt"
  signCAKeyPath: "/etc/ssl/certs/ca.key"
  signHoursValid: "2048h"
  signRSABits: 2048
  signVaultToken: ""
  signVaultHost: ""
  signVaultPKIPath: "pki_int"
  signVaultRole: "agent"

postgresqlcerts:
  ## If you want to use an external database, set this to false and change postgresqlHost & postgresqlPort
  enabled: false
  name: postgresql-certs
  postgresqlHost: postgresql-certs
  postgresqlPort: "5432"
  auth:
    postgresPassword: postgres
    username: magistrala
    password: magistrala
    database: certs
  resources:
    requests:
      cpu: 25m
  persistence:
    size: 1Gi


ui:
  image: {}
  port: 9090
  redirectUrl: https://localhost
  httpAdapterUrl: "http://magistrala-adapter-http:8008"
  usersUrl: "http://magistrala-users:9002"
  thingsUrl: "http://magistrala-things:9000"
  readerUrl: "http://magistrala-timescale-reader:8911"
